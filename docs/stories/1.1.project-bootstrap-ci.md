# Story 1.1: 项目骨架与持续集成

## Status
Draft

## Story
**As a** 后端工程师,
**I want** 初始化 MCP 服务仓库与基础框架,
**so that** 团队可以在统一结构下协作并自动验证提交。

## Acceptance Criteria
1. 配置 Monorepo 结构，包含 `metadata/`、`mcp_commands/`、`service/`、`docs/` 等目录。
2. 引入 FastAPI/uvicorn 并提供基础健康检查路由。
3. 建立 CI（Lint + Unit Test）流程，PR 合并需自动执行。
4. 编写 README 说明启动方式与目录结构。

## Tasks / Subtasks
- [ ] 目录骨架与配置管理 (AC: 1, 4)
  - [ ] 创建并提交 `metadata/`, `mcp_commands/`, `service/`, `docs/`, `infrastructure/`, `shared/`, `tests/` 目录，与 `pyproject.toml`, `Makefile` 等基础文件占位 [Source: architecture/source-tree.md#source-tree]
  - [ ] 在 README 中概述目录职责、启动命令与依赖版本 [Source: architecture/high-level-architecture.md#high-level-overview]
- [ ] FastAPI 应用基线 (AC: 2)
  - [ ] 初始化 `service/app/main.py`，挂载 FastAPI 实例与 `GET /health` 路由返回标准化响应 [Source: architecture/components.md#mcp-api-layer-fastapi]
  - [ ] 预留 `api/`, `core/`, `orchestrator/`, `rate_limit/`, `repositories/`, `schemas/`, `security/` 子包结构 [Source: architecture/source-tree.md#source-tree]
- [ ] 异步运行与依赖配置 (AC: 2)
  - [ ] 配置 `uvicorn` 启动脚本与 `pyproject.toml` 依赖（FastAPI, uvicorn, anyio） [Source: architecture/tech-stack.md#technology-selection-table]
  - [ ] 在 `shared/config/` 中创建默认配置占位，包含 tushare Token 读取钩子 [Source: architecture/components.md#auth-secrets-manager]
- [ ] CI 与质量保障 (AC: 3)
  - [ ] 配置 GitHub Actions Workflow，执行 `ruff` + `black` 检查与 `pytest` 单元测试 [Source: architecture/coding-standards.md#coding-standards]
  - [ ] 为 `service/tests/unit/` 添加示例测试，验证健康检查路由返回规范结构 [Source: architecture/test-strategy-and-standards.md#test-types-and-organization]
- [ ] 文档与后续扩展对齐 (AC: 4)
  - [ ] 在 README 中记录部署策略与后续环境演进路径 [Source: architecture/infrastructure-and-deployment.md#deployment-strategy]
  - [ ] 标注未来指令、限频与日志模块在仓库中的位置，指向对应组件 [Source: architecture/components.md#component-diagram]

## Dev Notes
### Previous Story Insights
本故事为项目首个故事，无可继承的前置实施记录。

### Data Models
当前仅搭建服务骨架，不涉及 `DataSource`、`InterfaceMetadata` 等数据模型实现，可在后续元数据相关故事落地 [Source: architecture/data-models.md#data-models]

### API Specifications
FastAPI 层后续需实现 `GET /mcp/commands`, `POST /mcp/execute`, `POST /auth/token` 等接口；本故事只需预留结构并确保健康检查符合统一响应模式 [Source: architecture/rest-api-spec.md#mcpcommands]

### Component Specifications
需为 Metadata Parser、Command Template Generator、Execution Orchestrator、Rate Limit Adapter、Auth Manager、Logging 等组件预留模块目录与依赖占位，保证后续故事按图示对齐 [Source: architecture/components.md#component-diagram]

### File Locations
按统一源代码结构创建目录与文件，使 `service/app/`, `service/tests/`, `shared/config/`, `metadata/`, `mcp_commands/` 等位置与架构文档一致，利于后续自动化脚本与文档同步 [Source: architecture/source-tree.md#source-tree]

### Testing Requirements
单元测试位于 `service/tests/unit/`，使用 `pytest` + `pytest-asyncio`，覆盖健康检查等关键路径；需保持 ≥85% 基线覆盖并为集成测试预留结构 [Source: architecture/test-strategy-and-standards.md#test-types-and-organization]

### Technical Constraints
项目使用 Python 3.11.8、FastAPI 0.111、uvicorn 0.30/ gunicorn 22.0，并结合 structlog/OpenTelemetry、Typer 等依赖；须遵循 `ruff` + `black` 约束、统一请求 ID、禁止明文凭证 [Source: architecture/tech-stack.md#technology-selection-table][Source: architecture/coding-standards.md#coding-standards]

## Testing
- [ ] 单元测试：为 `GET /health` 编写 `service/tests/unit/test_health.py`
- [ ] 集成测试：预留 `service/tests/integration/` 结构，后续故事补充
- [ ] 端到端测试：标记依赖 docker-compose 的 CLI 流程，后续故事补充

## Change Log
| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-09-29 | v0.1 | 草拟故事文档，涵盖骨架、CI、测试与文档任务 | Scrum Master |
