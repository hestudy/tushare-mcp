# Test Design: Story 1.1

Date: 2025-09-29
Designer: Quinn (Test Architect)

## Test Strategy Overview
- **Total test scenarios:** 10
- **Unit tests:** 5 (50%)
- **Integration tests:** 4 (40%)
- **E2E tests:** 1 (10%)
- **Priority distribution:** P0: 4, P1: 4, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: 配置 Monorepo 结构并完善 README 概述

| ID             | Level       | Priority | Test                                                                 | Justification                                                   |
|----------------|-------------|----------|----------------------------------------------------------------------|-----------------------------------------------------------------|
| 1.1-UNIT-001   | Unit        | P1       | 验证目录模板枚举包含 `metadata/`, `mcp_commands/`, `service/` 等必需项 | 纯逻辑校验，可在不访问文件系统的场景下快速发现偏差             |
| 1.1-INT-001    | Integration | P1       | 执行 `make bootstrap` 或脚手架命令后检查目录/文件实际落地           | 需要文件系统交互与命令流程，验证工具链集成                     |
| 1.1-UNIT-004   | Unit        | P2       | README 静态分析确保包含“目录职责”“启动命令”“依赖版本”章节         | 结构性文本校验，无需外部依赖                                   |

### AC2: FastAPI 健康检查路由

| ID             | Level       | Priority | Test                                                                 | Justification                                                   |
|----------------|-------------|----------|----------------------------------------------------------------------|-----------------------------------------------------------------|
| 1.1-UNIT-002   | Unit        | P0       | 调用 `health_handler()` 返回状态码、服务名、依赖版本字段            | 纯函数/路由逻辑校验，可快速捕获响应结构破坏                   |
| 1.1-INT-002    | Integration | P0       | 使用 `TestClient` 启动 FastAPI 应用并请求 `GET /health`             | 验证路由绑定、依赖注入与应用配置                               |
| 1.1-E2E-001    | E2E         | P1       | 通过 `make run` 启动 uvicorn，HTTP 请求 `/health` 验证 200 与 payload | 真实进程与网络调用，确保部署脚本与运行参数正确                 |

### AC3: Lint + Unit Test CI 流程

| ID             | Level       | Priority | Test                                                                 | Justification                                                   |
|----------------|-------------|----------|----------------------------------------------------------------------|-----------------------------------------------------------------|
| 1.1-INT-003    | Integration | P0       | 在 CI 环境（或 `act`）执行 GitHub Actions 工作流，校验 Ruff/Black/Pytest 步骤 | 涉及外部依赖与流水线，确保合并前质量闸门有效                   |
| 1.1-UNIT-003   | Unit        | P2       | 验证 `pyproject.toml`/`requirements-dev.txt` 定义 Ruff、Black、pytest 版本 | 配置文件解析与字段校验即可完成，快速发现缺失依赖               |

### AC4: README 文档说明与未来扩展

| ID             | Level       | Priority | Test                                                                 | Justification                                                   |
|----------------|-------------|----------|----------------------------------------------------------------------|-----------------------------------------------------------------|
| 1.1-UNIT-005   | Unit        | P0       | 检查配置读取逻辑，确保 Tushare Token 通过环境变量或密钥管理注入     | 安全关键路径，应在最小范围内快速检测凭证管理错误               |
| 1.1-INT-004    | Integration | P1       | 按 README 步骤执行本地启动（依赖安装、`make run`, `make test`）并记录可用性 | 跨多个命令与依赖的操作流，确保文档真实可用并缩短新人导入时间 |

## Risk Coverage

| Risk ID  | Mitigated By                                           |
|----------|--------------------------------------------------------|
| TECH-001 | 1.1-UNIT-001, 1.1-INT-001                              |
| OPS-001  | 1.1-INT-001, 1.1-INT-003, 1.1-E2E-001                  |
| SEC-001  | 1.1-UNIT-005                                           |
| PERF-001 | 1.1-UNIT-002, 1.1-INT-002, 1.1-E2E-001                 |
| OPS-002  | 1.1-UNIT-004, 1.1-INT-004                              |

## Recommended Execution Order
1. P0 单元测试：1.1-UNIT-002, 1.1-UNIT-005
2. P0 集成测试：1.1-INT-002, 1.1-INT-003
3. P1 测试：1.1-UNIT-001, 1.1-INT-001, 1.1-E2E-001, 1.1-INT-004
4. P2 测试：1.1-UNIT-003, 1.1-UNIT-004

---
Test design matrix: qa.qaLocation/assessments/1.1-test-design-20250929.md
P0 tests identified: 4
